@using Domain.Enums

<li class="task-card @CssDeadline" @onclick="OpenModal" >
    <div class="container py-1 px-4 default-text" style="min-height: 150px;">
        <div class="row py-1 @CssMarginTitle">
            <div class="px-0 d-flex flex-row">
                @if (Task.Priority == Domain.Enums.Priority.High)
                {
                    <div style="margin-right: 5px;" class="align-self-center">
                        <Tool IconName="IconName.ArrowUpCircleFill" IconColor="IconColor.Primary" 
                            TooltipTitle="Приоритет - Высокий" TooltipPlacement="TooltipPlacement.Bottom" />
                    </div>
                }
                <div style="overflow: hidden;" class="fw-bold fs-6">@Task.Title</div>
            </div>
        </div>
        @if (Task.Description is { })
        {
            <div class="row fw-light max-height-100 desc-text" >
                @Task.Description
            </div>
        }
        @if (Task.Subtasks.Any())
        {
            <div class="row py-1">
                <div class="d-flex justify-content-end">
                    + @Task.Subtasks.Count() подзадачи
                </div>
            </div>
        }
        @if (Task.MilestoneId is { })
        {
            <div class="row py-1">
                <div class="px-0">
                    <MilestoneLabel Milestone="@State.GetMilestone(Task.MilestoneId)" />
                </div>
            </div>
        }
        @if (Task.Responsibles.Any())
        {
            <div class="row py-1">
                <div class="px-0">
                    <ResponsiblesView Responsibles="Task.Responsibles" ImageSize="25" ShowName="true" MaxCount="2" />
                </div>
            </div>
        }
        @if (taskTags.Count > 0)
        {
            <div class="row py-1">
                <div class="d-flex flex-wrap gap-1 px-0">
                    @foreach (var tag in taskTags)
                    {
                        <TaskTagLabel Tag="tag" Color="TagColorGetter.GetColor(tag)" />
                    }
                </div>
            </div>
        }
        @if (Task.Deadline is { })
        {
            <div class="row">
                <div class="d-flex p-0 justify-content-end align-items-center">
                    @if (Task.IsDeadlineOut())
                    {
                        <Tool IconName="IconName.Fire" IconColor="IconColor.Danger" 
                            TooltipTitle="@(GetDeadlineString("Срок истек - {0} {1} назад"))" TooltipPlacement="TooltipPlacement.Left" />
                    }
                    else if (Task.IsSevenDaysDeadlineOut())
                    {
                        <Tool IconName="IconName.ExclamationTriangleFill" IconColor="IconColor.Warning"
                            TooltipTitle="@(GetDeadlineString("Крайний срок истечет через {0} {1}"))" TooltipPlacement="TooltipPlacement.Left" />
                    }
                    <span class="small ms-2 @(Task.IsDeadlineOut() ? "text-danger" : "fw-lighter")" >
                        Крайний срок:
                        @Task.Deadline?.ToString("d MMM yyyy г.")
                    </span>
                </div>
            </div>
        }
    </div>
</li>
