@using Onlyoffice.Api.Models.Authentication

@inject IAuthApiLogic AuthApiLogic
@inject ToastService ToastService

<div class="d-flex flex-column">
    <span class="font-monospace mb-1">Почта / Логин</span>
    <InputText id="user-name-input" class="form-control" @bind-Value="userName" />    
</div>

<div class="d-flex flex-column mt-4">
    <span class="font-monospace mb-1">Пароль</span>
    <InputText type="password" id="password-input" class="form-control" @bind-Value="password" />
</div>

<div class="mt-2 d-flex justify-content-center">
    <Button Type="ButtonType.Submit" LoadingText="Загрузка" Loading="busy" @onclick="SumbitAuth" 
        Disabled="string.IsNullOrWhiteSpace(userName) || string.IsNullOrWhiteSpace(password)" 
        Color="ButtonColor.Success" >
        Войти
    </Button>
</div>

@code {
    string userName = "";
    string password = "";
    bool busy;
    
    [CascadingParameter] BlazoredModalInstance BlazoredModal { get; set; } = default!;

    async Task SumbitAuth()
    {
        busy = true;
        var status = await AuthApiLogic.LoginAsync(new LoginModel(userName, password));
        if (status == AuthenticationResponseType.Error)
        {
            ToastService.Notify(new(ToastType.Danger, title: "Ошибка авторизации", "Не удалось войти")); // todo:
        }
        else await BlazoredModal.CloseAsync(ModalResult.Ok(true));
        busy = false;
    }
}
