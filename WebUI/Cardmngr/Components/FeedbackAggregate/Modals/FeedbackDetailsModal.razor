@using Cardmngr.Shared.Feedbacks

@inherits AddEditModalBase<Feedback, FeedbackUpdateData>

@if (buffer is { })
{
    <Offcanvas Placement="MyOffcanvasPlacement.End" Class="my-offcanvas my-offcanvas-right"
        @ref="currentModal" OnClose="ShowCloseConfirm" >
        <EditForm Model="buffer" OnValidSubmit="SubmitAsync" @onkeydown="HandleKeyDown">
            <FluentValidationValidator />
            <OffcanvasHeader Class="py-0" Style="padding-top: 20px !important;">
                <AutoGrowTextArea style="font-size: 20px; font-weight: 500;" ReadOnly="!CanEdit"
                    @bind-Value="buffer.Title" class="p-0 w-100" Autofocus="true" />
            </OffcanvasHeader>
            <FluentValidationMessage For="() => buffer.Title" class="ms-3" />
            <OffcanvasBody Class="d-flex flex-column">
                <AutoGrowTextArea Resize="TextAreaResize.Vertical" Placeholder="Описание" Class="w-100"
                    @bind-Value="buffer.Description" Spellcheck="true" ReadOnly="!CanEdit" />
            </OffcanvasBody>
            @if (!IsAdd)
            {
                <div class="mt-2 px-3">
                    <UserBadge User="Model!.Creator" Text="Создатель" />
                </div>
            }
            <div class="d-flex ms-3 flex-row">
                <FluentButton Disabled="@(!CanEdit)" Type="ButtonType.Submit" >
                    @SubmitText
                </FluentButton>
                @if (!IsAdd)
                {
                    <FluentButton Class="ms-2" Disabled="@(!CanEdit)"
                            OnClick="DeleteAsync" >
                            Удалить
                    </FluentButton>
                }
            </div>
        </EditForm>
    </Offcanvas>
}

@code {
    bool enterPressed;

    void HandleKeyDown(KeyboardEventArgs e)
    {
        enterPressed = e.Key == "Enter";
    }
}