@inject AuthenticationStateProvider AuthenticationState

@using System.Text.Json

<div class="bb-top-row px-4 d-flex" style="background-color: var(--header-color); border: none;">
    <div class="col-md-1 d-flex justify-content-start">
        <Button class="py-0" Color="ButtonColor.Dark" Outline="true" @onclick="OpenSidebar" >
            <Icon Name="IconName.List" />
        </Button>
    </div>
    <div class="col-md-9">
        <ProjectNavigator />
        <FilterCustomizer />
    </div>
    <div class="col-md-2 d-flex justify-content-end">
        <Toolbar />
        @if (currentUser is { })
        {
            <ProfileTool Class="ms-3" UserProfile="currentUser" />
        }
    </div>
</div>

@code {
    private UserProfile? currentUser;

    [CascadingParameter(Name = "DetailsModal")] ModalOptions Options { get; set; } = null!;
    [CascadingParameter] IModalService Modal { get; set; } = null!;

    protected override void OnInitialized()
    {
        if (AuthenticationState is { })
        {
            var provider = AuthenticationState.ToCookieProvider();
            currentUser = JsonSerializer.Deserialize<UserProfile>(provider["Data"]);
        }
    }

    private async Task OpenSidebar()
    {
        await Modal.Show<HeaderMenuModal>("", new ModalParameters { { "Nothing", Enumerable.Empty<object>() } }, Options).Result;
            // TODO: ??? close animation only with parameter ???
    }
}
